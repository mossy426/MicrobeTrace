<div class="crosstab-wrapper">
  <div id="tool-btn-container" class="m-portlet">
    <span style="overflow: visible; position: relative; width: 110px;">
      <a title="Open Settings" class="btn btn-sm btn-clean btn-icon btn-icon-md" style="float:left" (click)="openSettings()"><i class="flaticon-settings primary"></i></a>
    </span>
    <span style="overflow: visible; position: relative; width: 110px;">
      <a title="Export Crosstab Data" class="btn btn-sm btn-clean btn-icon btn-icon-md" style="float:left" (click)="openExport()"><i class="flaticon-download primary"></i></a>
    </span>
    <span style="overflow: visible; position: relative; width: 110px;">
      <a title="Pivot Crosstab" class="btn btn-clean btn-icon btn-icon-md" style="float:left; padding: 2px 5px 3px 5px" (click)="pivotCrosstab()">
        <svg fill="none" width="20px" height="20px" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink">
          <path d="M35.5 20 H20 V35.5" stroke="#005DAA" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path>
          <path d="M15.5 31.5 L20 36 L24.5 31.5" stroke="#005DAA" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path>
          <path d="M31.5 15.5 L36 20 L31.5 24.5" stroke="#005DAA" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path>
          <path d="M10 4L10 44" stroke="#005DAA" stroke-width="2" stroke-linecap="round"></path>
          <path d="M4 10.0378L44 10" stroke="#005DAA" stroke-width="2" stroke-linecap="round"></path>
        </svg>
      </a>
    </span>
    <!--span style="overflow: visible; position: relative; width: 110px;">
      <a title="Pivot Crosstab" class="btn btn-sm btn-clean btn-icon btn-icon-md" style="float:left" (click)="pivotCrosstab()">
        <svg width="14px" height="14px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke="#005DAA" d="M20.92,6.62a1,1,0,0,0-.21-.33l-3-3a1,1,0,0,0-1.42,1.42L17.59,6H9A3,3,0,0,0,6,9v8.59l-1.29-1.3a1,1,0,0,0-1.42,1.42l3,3a1,1,0,0,0,.33.21.94.94,0,0,0,.76,0,1,1,0,0,0,.33-.21l3-3a1,1,0,0,0-1.42-1.42L8,17.59V9A1,1,0,0,1,9,8h8.59l-1.3,1.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0l3-3a1,1,0,0,0,.21-.33A1,1,0,0,0,20.92,6.62Z"/>
        </svg></a>
    </span>
    <span style="overflow: visible; position: relative; width: 110px;">
      <a title="Pivot Crosstab" class="btn btn-clean btn-icon btn-icon-md" style="float:left; padding: 2px 5px 3px 5px" (click)="pivotCrosstab()">
        <svg fill="none" width="20px" height="20px" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
          <path d="M18.0088 34.0083H33.5005V18.0083" stroke="#005DAA" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M22.5 38.5L21 37L18 34L21 31L22.5 29.5" stroke="#005DAA" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M29 22.5L30.5 21L33.5 18L36.5 21L38 22.5" stroke="#005DAA" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M10 4L10 44" stroke="#005DAA" stroke-width="2" stroke-linecap="round"/>
          <path d="M4 10.0378L44 10" stroke="#005DAA" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </a>
    </span-->
  </div>

  <div class="row align-items-center">
    <div class="primeng-datatable-container">
      <p-table #dt *ngIf="SelectedTableData" 
        [value]="SelectedTableData.data"
        [columns]="SelectedTableData.tableColumns"
        [resizableColumns]="true"
        [styleClass]="selectedSize"
        [scrollable]="true"
        [scrollHeight]="scrollHeight"
        [tableStyle]="tableStyle"
        ScrollWidth="100%">
        <ng-template pTemplate="header" let-columns>
          <tr>
            <th *ngFor="let col of SelectedTableData.tableColumns" pSortableColumn="{{col.field}}" pReorderableColumn>
              {{ col.header}} <p-sortIcon field="{{col.field}}"></p-sortIcon>
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-column="SelectedTableData.tableColumns">
          <tr>
            <td *ngFor="let col of SelectedTableData.tableColumns">
              {{ rowData[col.field] }}
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="footer">
          <tr>
            <td *ngFor="let col of SelectedTableData.tableColumns">
              {{ totalRow[col.field] }}
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <p-dialog *ngIf="viewActive" id="crosstab-settings-pane" [(visible)]="settingsOpen"
    header="Crosstab Settings" [contentStyle]="{'max-height': '70vh', 'width': '400px'}" appendTo="body">
    <div class="form-group row" title="What data fields would you like to aggregate on?">
      <div class="col-3">Dataset</div>
      <div class="col-9">
        <p-selectButton [options]="datasetOptions" [(ngModel)]="this.widgets['crosstab-selectedDataset']" (onChange)="updateDataSet()"></p-selectButton>
      </div>
    </div>
    <div class="form-group row" title="">
      <div class="col-3"><a>X</a></div>
      <div class="col-9">
        <p-dropdown [options]="selectedFieldList" [(ngModel)]="xVariable" (ngModelChange)="onDataChange()" appendTo="body"></p-dropdown>
      </div>
    </div>
    <div class="form-group row" title="">
      <div class="col-3"><a>Y</a></div>
      <div class="col-9">
        <p-dropdown [options]="selectedFieldList" [(ngModel)]="yVariable" (ngModelChange)="onDataChange()" appendTo="body"></p-dropdown>
      </div>
    </div>
    <div class="form-group row" title="Show raw counts or proportion of total?">
      <div class="col-3"><label>Show</label></div>
      <div class="col-9">
        <p-selectButton [options]="showOptions" [(ngModel)]="widgets['crosstab-useProportion']" [multiple]="false" (onChange)="useProportionChanged()"></p-selectButton>
      </div>
    </div>
    <div class="form-group row" title="What size would you like the Table's font to be?">
      <div class="col-3"><label for="table-font-size">Size</label></div>
      <div class="col-9">
        <p-selectButton [options]="sizes" [(ngModel)]="selectedSize" [multiple]="false" optionLabel="name" optionValue="class"></p-selectButton>
      </div>
    </div>
  </p-dialog>

  <p-dialog *ngIf="viewActive" [(visible)]="exportOpen" header="Export Crosstab" appendTo="body">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-body" style='width: 400px; height: 100%;'>
          <div class="form-group row">
            <div class="col-8">
              <input type="text" style="height:42px" class="form-control form-control-sm" placeholder="Filename" [(ngModel)]="SelectedCrossTabExportFilename">
            </div>
            <div class="col-4">
              <p-dropdown [options]="CrossTabExportFileTypeList" [(ngModel)]="SelectedCrossTabExportFileType" appendTo="body"></p-dropdown>
            </div>
          </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-error" (click)="exportOpen = !exportOpen">Cancel</button>
            <button type="button" class="btn btn-primary" (click)="exportVisualization()">Export</button>
        </div>
      </div><!-- /.modal-dialog -->
    </div>
  </p-dialog><!-- /.modal -->
</div>